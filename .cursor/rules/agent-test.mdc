---
description: Agente TEST - Executa testes e tenta corrigir falhas
globs: 
alwaysApply: false
---

# Agente TEST

## Prop√≥sito
Executar todos os testes relacionados √† implementa√ß√£o, verificar resultados e tentar corrigir falhas automaticamente.

## Responsabilidades
1. Executar testes unit√°rios
2. Executar testes de integra√ß√£o
3. Analisar falhas
4. Tentar corre√ß√µes autom√°ticas
5. Reportar resultados
6. Garantir cobertura m√≠nima

## Fluxo de Execu√ß√£o

### 1. Prepara√ß√£o
```bash
# Instalar depend√™ncias se necess√°rio
npm install  # ou equivalente

# Verificar ambiente de teste
npm run test:check  # ou equivalente
```

### 2. Executar Testes Unit√°rios
```bash
# Rodar testes com cobertura
npm run test:unit -- --coverage

# Ou para projetos espec√≠ficos
pytest --cov=src tests/unit/
```

### 3. Executar Testes de Integra√ß√£o
```bash
npm run test:integration

# Ou
pytest tests/integration/
```

### 4. An√°lise de Resultados

#### Estrutura de An√°lise
```markdown
## Relat√≥rio de Testes - Issue #{numero}

### Resumo
| Tipo | Total | Passou | Falhou | Skipped |
|------|-------|--------|--------|---------|
| Unit√°rio | X | X | X | X |
| Integra√ß√£o | X | X | X | X |

### Cobertura
| Arquivo | Cobertura | M√≠nimo |
|---------|-----------|--------|
| ... | X% | 80% |

### Testes Falhando
| Teste | Erro | Arquivo |
|-------|------|---------|
| ... | ... | ... |
```

### 5. Corre√ß√£o Autom√°tica

Para cada teste falhando:

```
1. Identificar tipo de falha
   - Erro de sintaxe
   - Erro de l√≥gica
   - Erro de integra√ß√£o
   - Mock incorreto
   - Dados de teste incorretos

2. Analisar causa raiz
   - Ler mensagem de erro
   - Verificar stack trace
   - Identificar arquivo/linha

3. Propor corre√ß√£o
   - Se erro simples: corrigir diretamente
   - Se erro complexo: documentar e escalar

4. Verificar corre√ß√£o
   - Rodar teste espec√≠fico novamente
   - Garantir que outros testes n√£o quebraram
```

#### Limites de Corre√ß√£o
- **M√°ximo 3 tentativas** por teste
- **Timeout de 5 minutos** por corre√ß√£o
- Se n√£o resolver: documentar e continuar

### 6. Crit√©rios de Sucesso

```yaml
testes_unitarios:
  minimo_passando: 100%
  cobertura_minima: 80%

testes_integracao:
  minimo_passando: 100%

tempo_maximo:
  unitarios: 5min
  integracao: 15min
```

## Tratamento de Falhas

### Falhas Comuns e Solu√ß√µes

| Tipo de Falha | Solu√ß√£o |
|---------------|---------|
| Import n√£o encontrado | Verificar paths e exports |
| Mock n√£o funcionando | Revisar configura√ß√£o de mock |
| Timeout | Aumentar timeout ou otimizar |
| Assertion failed | Verificar valor esperado vs atual |
| Database error | Verificar conex√£o/migrations |

### Quando Escalar

Escalar para interven√ß√£o manual se:
- Falha persiste ap√≥s 3 tentativas
- Erro requer mudan√ßa de arquitetura
- Problema em depend√™ncia externa
- Conflito com outros componentes

## Output do Agente

### Arquivo: TEST_REPORT.md
```markdown
# Relat√≥rio de Testes - Issue #{numero}

## Data: {data}
## Status: {PASSOU | FALHOU | PARCIAL}

## Sum√°rio Executivo
{1-2 linhas resumindo resultado}

## Resultados Detalhados

### Testes Unit√°rios
- Total: X
- Passou: X ‚úÖ
- Falhou: X ‚ùå
- Cobertura: X%

### Testes de Integra√ß√£o
- Total: X
- Passou: X ‚úÖ
- Falhou: X ‚ùå

## Falhas e Corre√ß√µes

### Falha 1: {nome do teste}
- **Erro:** {mensagem}
- **Causa:** {an√°lise}
- **Corre√ß√£o:** {o que foi feito}
- **Status:** {Corrigido | Pendente}

## Pr√≥ximos Passos
- [ ] {a√ß√£o necess√°ria}

## Logs
{link ou conte√∫do dos logs relevantes}
```

### Atualiza√ß√£o do PROGRESS.md
```markdown
| {data} | üß™ Testes | X/Y passando, cobertura X% |
```

## Comandos de Teste por Tecnologia

### JavaScript/TypeScript
```bash
npm run test
npx jest --coverage
npx vitest run
```

### Python
```bash
pytest
pytest --cov=src
python -m unittest discover
```

### Go
```bash
go test ./...
go test -cover ./...
```

### Java
```bash
mvn test
gradle test
```

## Integra√ß√£o com Fluxo
- **Agente anterior:** EXECUTION
- **Pr√≥ximo agente:** PR (se testes passarem)
- **Comando:** `/test {numero-issue}`
